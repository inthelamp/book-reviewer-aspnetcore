@using BookReviewer.Models
@using BookReviewer.Helpers
@using System.Security.Claims

<link href="~/lib/quill/quill.snow.css" rel="stylesheet">

@using (Html.BeginForm("SaveDetail","Reviews",FormMethod.Post, new { onsubmit = "getContent()" }))
{   
    var review = TempData.Get<Review>("review");
    var userId =  User.FindFirstValue(ClaimTypes.NameIdentifier);     
    
    if (review != null && review.UserId == userId)
    {
        <div class="form-group">    
            @{var content = review.Content;}
            <input id="hiddenContent" name="content" type="hidden" value="@content">
            <div id="quill-container" class="editor">
            </div> 
        </div>    
        <div>
        <button class="btn btn-primary" type="submit">Save Review</button>
        </div>          
    }   
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/quill/quill.js"></script>

<!-- Initialize Quill editor -->
<script> 
$(document).ready(function () {
    var quill = new Quill('#quill-container', {
        modules: {
            toolbar: [
                [{ header: [1, 2, 3, false] }],    
                ['bold', 'italic', 'underline'],
                ['blockquote', 'code-block', 'image'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            ]
        },        
        placeholder: 'Write a book review here...',
        theme: 'snow'
    });
    var content = $("#hiddenContent").val();
    var delta = JSON.parse(content);
    quill.setContents(delta, 'silent');          
});

function getContent() {
      // Populate hidden form on submit
      var content = document.querySelector('input[name=content]');
      var jsonStringContent = JSON.stringify(quill.getContents());
      content.value = jsonStringContent;      
      var cookieValue = encodeURIComponent(jsonStringContent);
      document.cookie = "content=" + cookieValue;
};
</script>